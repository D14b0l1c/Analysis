import pandas as pd
import sqlite3
import os

# Define input CSV and output database paths
csv_path = os.path.join("exploit_db", "index", "exploitdb_with_nvd.csv")
db_path = os.path.join("exploit_db", "index", "exploit_index.db")

# Load the merged CVE + Exploit dataset
df = pd.read_csv(csv_path)

# Create a connection to the SQLite database (it will be created if it doesn't exist)
conn = sqlite3.connect(db_path)

# Write the full CSV as a table in the SQLite database
df.to_sql("exploits", conn, if_exists="replace", index=False)

# Optional: Create indexes to improve query performance on commonly searched fields
with conn:
    conn.execute("CREATE INDEX IF NOT EXISTS idx_cve_id ON exploits(cve_id);")
    conn.execute("CREATE INDEX IF NOT EXISTS idx_platform ON exploits(platform);")
    conn.execute("CREATE INDEX IF NOT EXISTS idx_vendors ON exploits(vendors);")

# Close the connection
conn.close()

# Print confirmation messages
print(f"[âœ“] SQLite database created at: {db_path}")
